script:
################################################
## Roborock S5 Max - Clean rooms with repeats ##
################################################

# You need to find the segments/rooms to send in the params.
# For more information about this see:
# https://www.home-assistant.io/integrations/xiaomi_miio#retrieving-room-numbers

####### This configuration is settled to multi floor setup. 
####### Due to the map loaded in the app (mi home or roborock) you'll need to perform first a global clean (start) to load the map so the app/vacuum can load the correct map.
####### Try the delay and define by your own. In some cases 30 seconds is enough.


###### To single floor setups, just remove
##     - service: vacuum.start
##        data:
##          entity_id: vacuum.roborock
##      - delay: "00:01:00"
##     - service: vacuum.stop
##        data:
##          entity_id: vacuum.roborock
##     - delay: "00:00:03"

  aspirar_rc:
    alias: Aspirar RÃ©s do ChÃ£o
    sequence:
      - service: vacuum.start
        data:
          entity_id: vacuum.roborock
      - delay: "00:01:00"
      - service: vacuum.stop
        data:
          entity_id: vacuum.roborock
      - delay: "00:00:03"
      - service: xiaomi_miio.vacuum_clean_segment
        data_template:
          entity_id: vacuum.roborock
          segments: >-
            [{%- if is_state('input_boolean.aspirar_cozinha', 'on') -%}
               {%- if is_state('counter.aspirar_cozinha_x', '1') -%}
                  18,
               {%- elif is_state('counter.aspirar_cozinha_x', '2') -%}               
                  18,18,
               {%- else -%}
                  18,18,18,
               {%- endif %}
            {%- endif %}
            {%- if is_state('input_boolean.aspirar_escritorio', 'on') -%}
               {%- if is_state('counter.aspirar_escritorio_x', '1') -%}
                  16,
               {%- elif is_state('counter.aspirar_escritorio_x', '2') -%}               
                  16,16,
               {%- else -%}
                  16,16,16,
               {%- endif %}
            {%- endif -%}
            {%- if is_state('input_boolean.aspirar_wc_rc', 'on') -%}
               {%- if is_state('counter.aspirar_wc_rc_x', '1') -%}
                  17,
               {%- elif is_state('counter.aspirar_wc_rc_x', '2') -%}               
                  17,17,
               {%- else -%}
                  17,17,17,
               {%- endif %}  
            {%- endif %}
            {%- if is_state('input_boolean.aspirar_corredor', 'on') -%} 
               {%- if is_state('counter.aspirar_corredor_x', '1') -%}
                  19,
               {%- elif is_state('counter.aspirar_corredor_x', '2') -%}               
                  19,19,
               {%- else -%}
                  19,19,19,
               {%- endif %}
            {%- endif %}
            {%- if is_state('input_boolean.aspirar_sala', 'on') -%}
               {%- if is_state('counter.aspirar_sala_x', '1') -%}
                  20,
               {%- elif is_state('counter.aspirar_sala_x', '2') -%}               
                  20,20,
               {%- else -%}
                  20,20,20,
               {%- endif %}
            {%- endif %}]

  aspirar_piso1:
    alias: Aspirar Piso1
    sequence:
      - service: vacuum.start
        data:
          entity_id: vacuum.roborock
      - delay: "00:01:00"
      - service: vacuum.stop
        data:
          entity_id: vacuum.roborock
      - delay: "00:00:03"
      - service: xiaomi_miio.vacuum_clean_segment
        data_template:
          entity_id: vacuum.roborock
          segments: >-
            {%- if is_state('input_boolean.aspirar_francisco', 'on') -%}
               {%- if is_state('counter.aspirar_francisco_x', '1') -%}
                  17,
               {%- elif is_state('counter.aspirar_francisco_x', '2') -%}               
                  17,17,
               {%- else -%}
                  17,17,17,
               {%- endif %}
            {%- elif is_state('input_boolean.aspirar_maria', 'on') -%}
               {%- if is_state('counter.aspirar_maria_x', '1') -%}
                  18,
               {%- elif is_state('counter.aspirar_maria_x', '2') -%}               
                  18,18,
               {%- else -%}
                  18,18,18,
               {%- endif %}
            {%- elif is_state('input_boolean.aspirar_wc_piso1', 'on') -%}
               {%- if is_state('counter.aspirar_wc_piso1_x', '1') -%}
                  16,
               {%- elif is_state('counter.aspirar_wc_piso1_x', '2') -%}               
                  16,16,
               {%- else -%}
                  16,16,16,
               {%- endif %}
            {%- elif is_state('input_boolean.aspirar_hall_piso1', 'on') -%} 
               {%- if is_state('counter.aspirar_hall_piso1_x', '1') -%}
                  19,
               {%- elif is_state('counter.aspirar_hall_piso1_x', '2') -%}               
                  19,19,
               {%- else -%}
                  19,19,19,
               {%- endif %}
            {%- elif is_state('input_boolean.aspirar_suite', 'on') -%}
               {%- if is_state('counter.aspirar_suite_x', '1') -%}
                  20,
               {%- elif is_state('counter.aspirar_suite_x', '2') -%}               
                  20,20,
               {%- else -%}
                  20,20,20,
               {%- endif %}
            {%- elif is_state('input_boolean.aspirar_wc_suite', 'on') -%}
               {%- if is_state('counter.aspirar_wc_suite_x', '1') -%}
                  21,
               {%- elif is_state('counter.aspirar_wc_suite_x', '2') -%}               
                  21,21,
               {%- else -%}
                  21,21,21,
               {%- endif %}
            {%- endif -%}
